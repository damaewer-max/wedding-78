<!DOCTYPE html>
<html lang="ru">
<head>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Свадьба Александра и Анастасии</title>

<link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:url("photo.jpg") center/cover fixed no-repeat;
  color:#333;
}

/* ===== стартовый экран ===== */

.hero{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
  background:linear-gradient(rgba(255,255,255,.85),rgba(255,255,255,.85));
}

.hero-box{
  width:100%;
  max-width:750px;
  background:#ffffffee;
  border-radius:24px;
  padding:30px;
  box-shadow:0 10px 40px rgba(0,0,0,.12);
  text-align:center;
  overflow:auto;
}

.hero h1{
  font-family:'Marck Script',cursive;
  font-size:48px;
  margin:0;
}

.hero button{
  margin-top:25px;
  padding:14px 28px;
  font-size:18px;
  border:none;
  border-radius:16px;
  background:#a8d8ff;
  cursor:pointer;
}

/* ===== карточка ===== */

.card{
  max-width:820px;
  margin:40px auto;
  padding:30px;
  background:#ffffffee;
  border-radius:20px;
  box-shadow:0 10px 40px rgba(0,0,0,.12);
  text-align:center;
}

h2{
  font-family:'Marck Script',cursive;
  margin-top:30px;
}

input,select{
  width:95%;
  padding:10px;
  margin:6px 0;
  border-radius:12px;
  border:1px solid #ddd;
}

input.error{
  border:2px solid #ff6b6b;
  background:#fff1f1;
}

.buttons{
  display:flex;
  gap:10px;
  justify-content:center;
}

button{
  padding:12px 22px;
  border:none;
  border-radius:12px;
  cursor:pointer;
}

.yes{background:#a8d8ff}
.no{background:#f4c6c6}

.notice{
  background:#fff4f4;
  border:2px solid #ffd1d1;
  padding:15px;
  border-radius:12px;
}

.timeline div{
  background:#f2f8ff;
  margin:5px 0;
  padding:8px;
  border-radius:10px;
}

.toast{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:#ff6b6b;
  color:#fff;
  padding:12px 20px;
  border-radius:12px;
  opacity:0;
  transition:.3s;
}

.toast.show{opacity:1}
.hidden{display:none}
.total{margin-top:10px;font-weight:bold}
</style>
</head>

<body>

<!-- старт -->
<div id="start" class="hero">
  <div class="hero-box">

    <h1>Александр & Анастасия</h1>
    <h2>23 мая 2026</h2>

    <div class="message">
      <p>Мы счастливы поделиться с вами самым важным и тёплым событием в нашей жизни — днём, когда мы станем семьёй.</p>
      <p>Приглашаем провести этот день вместе с нами и разделить радость праздника.</p>
      <p>Ваше присутствие — самый ценный подарок для нас.</p>
      <p>Будем благодарны, если вы воздержитесь от криков «Горько».</p>
    </div>

    <h2>Дресс-код</h2>
    <p>Нежно-голубые, белые и пастельные оттенки</p>

    <button id="openBtn">Открыть приглашение</button>

  </div>
</div>

<!-- приглашение -->
<div id="invite" class="hidden">

<div class="card">

<h2>Программа дня</h2>

<div class="timeline">
  <div>13:20 — выкуп невесты</div>
  <div>15:40 — роспись в ЗАГСе, г. Ростов-на-Дону, Университетский 48</div>
  <div>16:10 — прогулка (по желанию)</div>
  <div>18:00 — банкет, г. Ростов-на-Дону, Левобережная 50</div>
</div>

<h2>Подтвердите присутствие</h2>

<div class="notice">
❗ Укажите только фамилию и количество человек
</div>

<input id="nameInput" placeholder="Фамилия">
<input id="countInput" type="number" value="1" min="1">

<select id="transferSelect">
<option>Трансфер не нужен</option>
<option>Только до торжества</option>
<option>Только после торжества</option>
<option>До и после торжества</option>
</select>

<select id="foodSelect">
<option>Нет особенностей</option>
<option>Не ем мясо</option>
<option>Не ем рыбу</option>
<option>Вегетарианец</option>
</select>

<select id="alcoholSelect">
<option>Красное вино</option>
<option>Белое вино</option>
<option>Шампанское</option>
<option>Виски/коньяк</option>
<option>Водка</option>
<option>Самогон</option>
<option>Не буду пить алкоголь</option>
</select>

<select id="kidsSelect">
<option>Без ребёнка</option>
<option>С ребёнком</option>
</select>

<div class="buttons">
<button class="yes" id="yesBtn">Приду</button>
<button class="no" id="noBtn">Не смогу</button>
</div>

<div id="totalGuests" class="total"></div>
<button id="downloadBtn">Скачать ответы</button>

</div>
</div>

<div id="toast" class="toast"></div>

<script>
const SUPABASE_URL = "https://jwntfrnwwoeteohrukvs.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3bnRmcm53d29ldGVvaHJ1a3ZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzOTA2OTcsImV4cCI6MjA4NTk2NjY5N30.t6yZLQcr8t_kidmuOnKV-liewR_RiN7lcGpTPobREwI";

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const start=document.getElementById("start");
const invite=document.getElementById("invite");

document.getElementById("openBtn").onclick=()=>{
  start.classList.add("hidden");
  invite.classList.remove("hidden");
};

const nameInput=document.getElementById("nameInput");
const countInput=document.getElementById("countInput");
const transfer=document.getElementById("transferSelect");
const food=document.getElementById("foodSelect");
const alcohol=document.getElementById("alcoholSelect");
const kids=document.getElementById("kidsSelect");
const toast=document.getElementById("toast");
const total=document.getElementById("totalGuests");
const downloadBtn=document.getElementById("downloadBtn");

/* скрываем админ-элементы */
downloadBtn.style.display="none";
total.style.display="none";


/* по умолчанию скрыто */
downloadBtn.style.display="none";
total.style.display="none";

/* кнопка сброса */
const resetBtn=document.createElement("button");
resetBtn.textContent="Сбросить подтверждения";
resetBtn.style.display="none";
resetBtn.style.marginTop="10px";
document.querySelector(".card").appendChild(resetBtn);

function showToast(t){
  toast.textContent=t;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

/* упрощённая проверка фамилии */
function validate(){
  if(!nameInput.value.trim()){
    nameInput.classList.add("error");
    showToast("Введите фамилию");
    return false;
  }
  nameInput.classList.remove("error");
  return true;
}

/* показ админ-кнопок */
function showAdminControls(){
  const pass=prompt("Введите пароль");
  if(pass!=="3005") return;

  downloadBtn.style.display="inline-block";
  total.style.display="block";
  resetBtn.style.display="inline-block";
  updateTotal();
}

async function save(ans){
  const surname=nameInput.value.trim();

  if(!surname){
    nameInput.classList.add("error");
    showToast("Введите фамилию");
    return;
  }

  /* ===== вход админа (НЕ записываем в БД) ===== */
  if(ans==="Нет" && surname==="3005"){
    downloadBtn.style.display="inline-block";
    total.style.display="block";
    resetBtn.style.display="inline-block";
    updateTotal();
    nameInput.value="";
    showToast("Режим администратора");
    return;
  }

  /* ===== обычная запись ===== */
  const row={
    name:surname,
    guests:Number(countInput.value),
    answer:ans,      // Да или Нет
    transfer:transfer.value,
    food:food.value,
    alcohol:alcohol.value,
    kids:kids.value,
    time:new Date().toLocaleString("ru-RU")
  };

  await supabaseClient.from("wedding").insert([row]);

  /* уведомление */
  showToast("Ответ сохранён. Для изменения ответа перезагрузите страницу");

  /* блокируем повторную отправку */
  document.querySelectorAll("button, input, select").forEach(el=>{
    if(el!==downloadBtn && el!==resetBtn){
      el.disabled=true;
      el.style.opacity="0.6";
      el.style.cursor="not-allowed";
    }
  });
}



/* кнопки */
document.getElementById("yesBtn").onclick=()=>save("Да");
document.getElementById("noBtn").onclick=()=>save("Нет");

/* подсчёт */
async function updateTotal(){
  const { data } = await supabaseClient
    .from("wedding")
    .select("name");

  /* считаем семьи (каждая запись = 1 семья) */
  const families = data?.length || 0;

  total.textContent="Всего ответило семей: " + families;
}


/* скачивание CSV */
downloadBtn.onclick=async()=>{
  const { data } = await supabaseClient.from("wedding").select("*");

  const rows=[["Фамилия","Гостей","Ответ","Трансфер","Еда","Алкоголь","Дети","Время"]];

  data.forEach(r=>{
    rows.push([r.name,r.guests,r.answer,r.transfer,r.food,r.alcohol,r.kids,r.time]);
  });

  const csv=rows.map(r=>r.join(";")).join("\n");
  const blob=new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8;"});

  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="answers.csv";
  a.click();
};

/* сброс подтверждений */
resetBtn.onclick=async()=>{
  await supabaseClient.from("wedding").delete().gt("id", 0); // удалить все строки
  updateTotal();
  showToast("База очищена");
};




</script>

</body>
</html>
